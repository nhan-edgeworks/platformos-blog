{%- capture url_template -%}
{% if params.language %}/{lang}{%- endif -%}/<%= blog_home=%>blog{/category}{/tags}{?page,per_page}
{%- endcapture -%}

{% assign url_params = context.location.href | extract_url_params: url_template %}
{% assign slug = url_params.slug[1] | default: 'blog' %}
{% assign tags = url_params.tags | replace: '-', ' ' | default: null %}
{% assign pagination_page = context.params.page | default: 1 | plus: 0 %}


{% assign per_page = context.params.per_page  | default: 10 | plus: 0 %}
{% if pagination_page == 1 %}
{% assign feature_post_first = true %}
{% endif %}

{%- query_graph 'modules/dashboard_blog/get_blog_instance', result_name: bi, scope: 'blog', enabled: 'true' -%}
{% assign blog_instance = bi.customizations.results.first %}
{%- query_graph 'modules/dashboard_blog/get_blog_posts', result_name: g, published_at_lte: today, per_page: per_page, page: pagination_page, blog_instance_id: blog_instance.id, tags: tags -%}
{% assign blog_posts = g.customizations.results %}
<section>
    <div class="c-hero" data-src="{{blog_instance.header_image.transformed}}"
        style="background-image: url('{{blog_instance.header_image.transformed}}')">
    </div>
    <div class="container">
        <div class="row">
            <div class="col mb-3">
                <h1 class="title">{{blog_instance.title}} - <span class="title_color">Right Slidebar</span> </h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-9 mt-5">
                <div class="row">
                    {% for blog_post in blog_posts %}
                    {%- capture post_href -%}/blog/post/blog/{{ blog_post.slug }}{%- endcapture -%}

                    <div class="col-sm-12 col-md-6 d-inline">
                        <div class="card ">
                            <figure>
                                <img class="card-img-top" src="{{ blog_post.hero_image.transformed }}" emplate
                                    alt="Card image cap">
                            </figure>
                            <div class="card-body mb-5 p-0">
                                <p class="card_time">{{blog_post.published_at}}</p>
                                <p>Category:
                                    {% for tag in blog_post.tags%}
                                    <a href="/blog/category/{{tag}}">{{ tag | join: ',' }}.</a>
                                    {% endfor%}
                                </p>
                                <a href="{{post_href}}" style="color: #000">
                                    <h5 class="card-title">{{blog_post.title}} </h5>
                                </a>
                                <p class="card-text">{{blog_post.excerpt}}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="col-md-3 mt-5">
                <h4 class="media_title">News</h4>
                {% for blog_post in blog_posts %}
                {%- capture post_href -%}/blog/post/blog/{{ blog_post.slug }}{%- endcapture -%}
                <div class="media mt-4">
                    <div class="figure">
                        <img class="media_img mr-3" src="{{blog_post.hero_image.transformed}}"
                            alt="Generic placeholder image">
                    </div>
                    <div class="media-body">
                        <a href="{{post_href}}" style="color:#000">
                            <h5 class="text">{{blog_post.title}}</h5>
                        </a>
                    </div>
                </div>
                {% endfor %}
                <hr class="mt-5">
                <div class="media_tag mt-5">
                    <h4 class="tag_title">Tags</h4>
                    <div class="tag_item mt-4 ml-2">
                        <p class="tag">Design</p>
                        <p class="tag">Art</p>
                        <p class="tag">Graphic</p>
                        <p class="tag">HTML</p>
                        <p class="tag">CSS</p>
                        <p class="tag">SASS</p>
                        <p class="tag">WordPress</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>